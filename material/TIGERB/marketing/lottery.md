# 通用抽奖工具

## 前言

- 常见抽奖场景与归类
- 抽奖需求配置
- 常见奖品类型
- 抽奖五要素

## 常见抽奖场景与归类

红包雨、糖果雨、打地鼠、大转盘(九宫格)、考眼力、答题闯关、游戏闯关、支付订单刮奖等等活动营销场景

其实大致归为一下三类：

|类型|活动名称|特点|
|-|-|-|
|按时间抽奖|红包雨、糖果雨、打地鼠、幸运大转盘(九宫格)、考眼力|时间维度|
|按抽奖次数抽奖|答题闯关、游戏闯关|(成功参与)当前活动次数维度|
|按订单支付金额抽奖|支付订单刮奖|订单金额维度|

## 抽奖需求配置

我们先看`按时间抽奖`:

|按时间抽奖|是否多场次|单场次次数限制(次)|总场次次数限制(次)|
|-|-|-|-|
|红包雨|是|1|N|
|糖果雨|是|1|N|
|打地鼠|是|N|N|
|幸运大转盘(九宫格)|否|N|N|
|考眼力|否|N|N|

产生了活动和场次的概念:

- 活动activity:活动的日期范围
- 场次session:活动时间范围

示例：

红包雨需要支持多场次的，比如双十二期间三天、每天三场整点红包雨配置如下

```md
配置活动:
2019-12-10 ~ 2019-12-12
配置场次:
10:00:00 ~ 10:01:00
12:00:00 ~ 12:01:00
18:00:00 ~ 18:01:00

---
上面配置的结果如下：

2019-12-10日三场整点红包雨：
2019-12-10 10:00:00 ~ 10:01:00
2019-12-10 12:00:00 ~ 12:01:00
2019-12-10 18:00:00 ~ 18:01:00

2019-12-11日三场整点红包雨：
2019-12-11 10:00:00 ~ 10:01:00
2019-12-11 12:00:00 ~ 12:01:00
2019-12-11 18:00:00 ~ 18:01:00

2019-12-12日三场整点红包雨：
2019-12-12 10:00:00 ~ 10:01:00
2019-12-12 12:00:00 ~ 12:01:00
2019-12-12 18:00:00 ~ 18:01:00
```

幸运大转盘不需要多场次，比如年货节2020-01-20 ～ 2020-02-10期间幸运大转盘配置如下

```md
配置活动:
2019-12-09 ~ 2019-12-12
配置场次
00:00:00 ~ 23:59:59

---
上面配置的结果如下：

幸运大转盘抽奖活动于 2019-12-09 00:00:00 ~ 2019-12-12 23:59:59 进行
```

不需要多个场次，只配置一个场次即可

完全复用

按抽奖次数抽奖:

每一关的奖品不同，一般越到后面中大奖的几率越大

|答题闯关|奖品|
|------|------|
|第一关|优惠券2元|
|第二关|优惠券5元|
|第三关|优惠券10元|
|第四关|优惠券20元|
|第五关|优惠券50元|
|第六关|优惠券100元|

同理活动&场次配置完全复用，同幸运大转盘配置(不需要支持多场次)

按订单支付金额抽奖：

不同的订单金额，一般金额越大中大奖的几率越大

|订单金额|奖品1|奖品2|---|奖品N|
|------|------|------|---|------|
|0~100|优惠券2元|空奖|---|无|
|100~200|优惠券5元|空奖|---|无|
|200~1000|优惠券10元|优惠券20元|---|空奖|
|1000以上|优惠券50元|笔记本电脑|---|空奖|

同理活动&场次配置完全复用，同幸运大转盘配置(不需要支持多场次)

> 抽奖抽什么？

## 常见奖品类型

|常见奖品类型|
|-|
|优惠券|
|积分|
|实物|
|空奖|

奖品有了

## 抽奖五要素

通过上面的分析我们已经得到了抽奖的**三要素**

- 活动 
- 场次 
- 奖品

那还有什么要素我们还没聊到呢？接下来来看。

> 中奖概率：抽奖自然离不开奖品的中奖概率的设置。

关于中奖概率我们支持如下灵活的配置：

1. 手动设置奖品中奖概率
2. 自动概率，根据当前奖品的数量、奖品的权重得到中奖概率

比如我们某次大促活动**红包雨**的配置如下：

活动配置|描述
------|------
活动时间|2019-12-10~2019-12-12
活动名称|2019双十二大促整点红包雨
活动描述|2019双十二大促全端整点红包雨活动
手动设置奖品概率|是

|场次配置|奖品类型|具体奖品|奖品数量|中奖概率
|-|-|-|-|-|-|
|10:00:00 ~ 10:01:00|优惠券|2元优惠券|2000|50%|
|-|优惠券|5元优惠券|1000|20%|
|-|空奖|-|5000|30%|
|12:00:00 ~ 12:01:00|优惠券|2元优惠券|2000|50%|
|-|优惠券|5元优惠券|1000|20%|
|-|空奖|-|5000|30%|
|18:00:00 ~ 18:01:00|优惠券|2元优惠券|2000|50%|
|-|优惠券|5元优惠券|1000|20%|
|-|空奖|-|5000|30%|

备注：每轮场次中奖概率之和必须为100%，否则剩余部分默认添加为空奖的中奖概率。

这里我们就得到了抽奖的四个要素：中奖概率。

> 如何均匀的抽走奖品?

均匀投奖

拆分总奖品数量，到各个具体的时间段

```
10:00:00 ~ 16:00:00|优惠券|2元优惠券|2000|50%|
---------------------------------------------
投奖时间 |投放数量
--------|---------
10:00:00|500
11:00:00|300
12:00:00|300
13:00:00|300
14:00:00|300
15:00:00|300
```

这里我们就得到了抽奖的五个要素：均匀投奖。

抽奖五要素|要素名称
------|------
第一要素|活动
第二要素|场次
第三要素|奖品
第四要素|中奖概率
第五要素|均匀投奖

## 结语